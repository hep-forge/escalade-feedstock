{% set versions = {
    "HEAD": "latest",
    "v9.08.26": "b13f3bb4d4c9ac2ebd6c805ab9f153ea9a317d32"
} %}

{% set version = environ.get('COMMIT_VERSION', None) %}
{% set version = version or versions.keys()|first %}
{% set version = version|string %}

build:
  number: 0
  string: "torch{{ libtorch.replace('.', '') }}"
  ignore_run_exports_from:
    - tbb
    - tbb-devel

package:
  name: {{ environ.get('ANACONDA_PACKAGE', "escalade")|string|lower }}
  version: {{ environ.get('ANACONDA_VERSION', version)|replace("-", ".") }}

source:
  git_url: "https://git.ligo.org/kagra/libraries-addons/root/root-plus"
  git_rev: {{ version }}

requirements:
  build:
    - {{ compiler('cxx') }} # [linux]
    - {{ compiler('c') }}   # [linux]
    - {{ stdlib('c') }}

    - cmake
    - make

  host:
    - root {{ root }}.*
    - root-plus {{ root.replace('.', '') }}
    - mpi
    - hdf5

  run:
    - root {{ root }}.*
    - root-plus {{ root.replace('.', '') }}
    - gettext
    - bc
    - coreutils
    - mpi
    - hdf5

# requirements:
#   build:
#     - {{ compiler('cxx') }} # [linux]
#     - {{ compiler('c') }}   # [linux]
#     - {{ stdlib('c') }}

#     - clang
#     - cmake
#     - make

#     - cuda-nvcc

#   host:
#     - root
#     - root-plus
#     - minio-cpp=latest
#     - libdate-tz
#     - libarchive
#     - onnxruntime-cpp
#     - libtorch
#     - cudatoolkit
#     - tbb
#     - tbb-devel

#     - hdf5
#     - librdkafka
#     - inih
#     - curl
#     - nlohmann_json
#     - tomlplusplus
#     - libxml2
#     - yaml-cpp

#     - lalsuite

#   run:
#     - root
#     - root-plus

#     - minio-cpp=latest
#     - libdate-tz
#     - libarchive
#     - onnxruntime-cpp

#     - {{ pin_compatible('libtorch', max_pin='x.x') }}
#     - cudatoolkit
#     - tbb
#     - tbb-devel

#     - hdf5
#     - librdkafka
#     - inih
#     - curl
#     - nlohmann_json
#     - tomlplusplus
#     - libxml2
#     - yaml-cpp

#     - lalsuite

about:
  home: "https://git.ligo.org/kagra/libraries-addons/root/root-plus"
  license: "GPL-3.0"
  summary: "ROOT+ for Tensor Calculation & Advanced Signal Processing"
  description: |
    ROOT+ is an Open-Source library implementing complex tensor calculation, advanced signal processing. It can be used for scientific Machine Learning developments in C/C++"

extra:
  recipe-maintainers:
    - meiyasan
